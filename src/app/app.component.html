<div class="flex flex-row h-full">
  <div class="left sidebar min-h-full w-2 p-shadow-3 overflow-hidden z-3">
    <div class="p-1 flex flex-column h-full overflow-y-auto">
      <div class="flex flex-row">
        <span class="p-input-icon-right w-full" style="margin-bottom: 1px;">
          <i class="pi pi-search"></i>
          <input type="text" class="w-full" placeholder="Search" pInputText [(ngModel)]="leftSearch"
            (ngModelChange)="filterKeyArrays(leftSearch)" />
        </span>
        <div
          class="button-border border-clickable flex flex-column align-content-center justify-content-center color-surface-card"
          style="margin-bottom: 1px; margin-left: 1px;">
          <i class="pi pi-ellipsis-v icon-button"></i>
        </div>
      </div>
      <p-panel [toggleable]="true" #notes class="sidemenuPanel panel-hide-default-toggler notes" [collapsed]="true">
        <ng-template pTemplate="header">
          <div class="flex justify-content-between align-items-center">
            <button (click)="notes.toggle($event); $event.stopPropagation();" pButton pRipple type="button"
              [icon]="'pi '+(notes.collapsed?'pi-chevron-right':'pi-chevron-down')"
              class="p-panel-header-icon"></button>
            <i class="pi pi-fw pi-book" style="margin-right: 5px;"></i>
            <span>
              Notes
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="icons">
          <div class="flex justify-content-between align-items-center">
            <button (click)="addNoteOverlay.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi pi-plus'" class="p-panel-header-icon"></button>
          </div>
          <p-overlayPanel #addNoteOverlay>
            <ng-template pTemplate>
              <div class="flex flex-wrap flex-column">
                <input type="text" placeholder="Title for new Note/Folder" pInputText style="margin-bottom: 5px;"
                  #notefoldertitle />
                <div class="flex flew-wrap flex-row justify-content-between align-items-center">
                  <button pButton pRipple type="button" icon="pi pi-plus" label="Note" class="p-button-outlined"
                    (click)="onAddElementClick(notefoldertitle.value, 'notes')"></button>
                  <span>or</span>
                  <button pButton pRipple type="button" icon="pi pi-plus" label="Folder" class="p-button-outlined"
                    (click)="onAddNoteFolderClick(notefoldertitle.value)"></button>
                </div>
              </div>
            </ng-template>
          </p-overlayPanel>
        </ng-template>
        <ng-template pTemplate="content" *ngIf="noteKeys">
          <div *ngFor="let key of (filteredNoteKeys !== undefined ? filteredNoteKeys : noteKeys)" style="padding: 1px">
            <div class="flex flex-row justify-content-between hideChildUntilHoverParent">
              <div class="unbordered-element h-2rem pointerOnHover" (click)="onNoteClick(key, contentPanel)">
                {{key}}
              </div>
              <div
                class="button-unbordered border-clickable flex flex-column flex-wrap align-content-center justify-content-center color-surface-card hideChildUntilHoverChild"
                style="width: 32px;">
                <i class="pi pi-ellipsis-v icon-button"></i>
              </div>
            </div>
          </div>
        </ng-template>
      </p-panel>
      <p-panel [toggleable]="true" #categories class="sidemenuPanel panel-hide-default-toggler categories"
        [collapsed]="true">
        <ng-template pTemplate="header">
          <div class="flex justify-content-between align-items-center">
            <button (click)="categories.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi '+(categories.collapsed?'pi-chevron-right':'pi-chevron-down')"
              class="p-panel-header-icon"></button>
            <i class="pi pi-fw pi-tags" style="margin-right: 5px;"></i>
            <span>
              Categories
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="icons">
          <div class="flex justify-content-between align-items-center">
            <button (click)="addCategoryOverlay.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi pi-plus'" class="p-panel-header-icon"></button>
          </div>
          <p-overlayPanel #addCategoryOverlay>
            <ng-template pTemplate>
              <div class="flex flex-wrap flex-column">
                <input type="text" placeholder="Title for new category" pInputText style="margin-bottom: 5px;"
                  #categoryTitleInput />
                <button pButton pRipple type="button" icon="pi pi-plus" label="Category"
                  (click)="onAddElementClick(categoryTitleInput.value, 'categories')"
                  class="p-button-outlined"></button>
              </div>
            </ng-template>
          </p-overlayPanel>
        </ng-template>
        <ng-template pTemplate="content" *ngIf="categoryKeys">
          <div *ngFor="let key of (filteredCategoryKeys !== undefined ? filteredCategoryKeys : filteredCategoryKeys)"
            style="padding: 1px">
            <div class="flex flex-row justify-content-between hideChildUntilHoverParent">
              <div class="unbordered-element h-2rem pointerOnHover" (click)="onCategoryClick(key, contentPanel)">
                {{key}}
              </div>
              <div
                class="button-unbordered border-clickable flex flex-column flex-wrap align-content-center justify-content-center color-surface-card hideChildUntilHoverChild"
                style="width: 32px;">
                <i class="pi pi-ellipsis-v icon-button"></i>
              </div>
            </div>
          </div>
        </ng-template>
      </p-panel>
      <p-panel [toggleable]="true" #chronicle class="sidemenuPanel panel-hide-default-toggler chronicle"
        [collapsed]="true">
        <ng-template pTemplate="header">
          <div class="flex justify-content-between align-items-center">
            <button (click)="chronicle.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi '+(chronicle.collapsed?'pi-chevron-right':'pi-chevron-down')"
              class="p-panel-header-icon"></button>
            <i class="pi pi-fw pi-calendar" style="margin-right: 5px;"></i>
            <span>
              Chronicle
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="icons">
          <div class="flex justify-content-between align-items-center">
            <button (click)="addChronicleOverlay.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi pi-plus'" class="p-panel-header-icon"></button>
          </div>
          <p-overlayPanel #addChronicleOverlay>
            <ng-template pTemplate>
              <span>Unfortunately this feature is not yet supported by the current prototype version</span>
            </ng-template>
          </p-overlayPanel>
        </ng-template>
        <ng-template pTemplate="content">
        </ng-template>
      </p-panel>
      <p-panel [toggleable]="true" #atlas class="sidemenuPanel panel-hide-default-toggler atlas" [collapsed]="true">
        <ng-template pTemplate="header">
          <div class="flex justify-content-between align-items-center">
            <button (click)="atlas.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi '+(atlas.collapsed?'pi-chevron-right':'pi-chevron-down')"
              class="p-panel-header-icon"></button>
            <i class="pi pi-fw pi-map" style="margin-right: 5px;"></i>
            <span>
              Atlas
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="icons">
          <div class="flex justify-content-between align-items-center">
            <button (click)="addAtlasOverlay.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi pi-plus'" class="p-panel-header-icon"></button>
            <p-overlayPanel #addAtlasOverlay>
              <ng-template pTemplate>
                <span>Unfortunately this feature is not yet supported by the current prototype version</span>
              </ng-template>
            </p-overlayPanel>
          </div>
        </ng-template>
        <ng-template pTemplate="content">
        </ng-template>
      </p-panel>
      <p-panel [toggleable]="true" #generators class="sidemenuPanel panel-hide-default-toggler generators"
        [collapsed]="true">
        <ng-template pTemplate="header">
          <div class="flex justify-content-between align-items-center">
            <button (click)="generators.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi '+(generators.collapsed?'pi-chevron-right':'pi-chevron-down')"
              class="p-panel-header-icon"></button>
            <i class="pi pi-fw pi-briefcase" style="margin-right: 5px;"></i>
            <span>
              Generators
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="icons">
          <div class="flex justify-content-between align-items-center">
            <button (click)="addGeneratorsOverlay.toggle($event); $event.stopPropagation()" pButton pRipple
              type="button" [icon]="'pi pi-plus'" class="p-panel-header-icon"></button>
          </div>
          <p-overlayPanel #addGeneratorsOverlay>
            <ng-template pTemplate>
              <span>Unfortunately this feature is not yet supported by the current prototype version</span>
            </ng-template>
          </p-overlayPanel>
        </ng-template>
        <ng-template pTemplate="content">
        </ng-template>
      </p-panel>
      <p-panel [toggleable]="true" #resources class="sidemenuPanel panel-hide-default-toggler resources"
        [collapsed]="true">
        <ng-template pTemplate="header">
          <div class="flex justify-content-between align-items-center">
            <button (click)="resources.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi '+(resources.collapsed?'pi-chevron-right':'pi-chevron-down')"
              class="p-panel-header-icon"></button>
            <i class="pi pi-fw pi-cloud" style="margin-right: 5px;"></i>
            <span>
              Resources
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="icons">
          <div class="flex justify-content-between align-items-center">
            <button (click)="addResourcesOverlay.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi pi-plus'" class="p-panel-header-icon"></button>
          </div>
          <p-overlayPanel #addResourcesOverlay>
            <ng-template pTemplate>
              <span>Unfortunately this feature is not yet supported by the current prototype version</span>
            </ng-template>
          </p-overlayPanel>
        </ng-template>
        <ng-template pTemplate="content">
        </ng-template>
      </p-panel>

      <div class="flex-grow-1"></div>

      <p-panel [toggleable]="true" #projectPanel class="sidemenuPanel panel-hide-default-toggler" [collapsed]="true">
        <ng-template pTemplate="header">
          <div class="flex justify-content-between align-items-center">
            <button (click)="projectPanel.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi '+(projectPanel.collapsed?'pi-chevron-right':'pi-chevron-down')"
              class="p-panel-header-icon"></button>
            <i class="pi pi-fw pi-file-o" style="margin-right: 5px;"></i>
            <span>
              Project
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="content">
          <div style="margin: 1px" class="flex flex-row align-items-center unbordered-button h-2rem">
            <i class="pi pi-fw pi-plus-circle" style="margin-right: 5px;"></i>
            <div class=" pointerOnHover">
              New
            </div>
          </div>
          <div style="margin: 1px" class="flex flex-row align-items-center unbordered-button h-2rem" (click)="fileUpload.click()">
            <i class="pi pi-fw pi-upload" style="margin-right: 5px;"></i>
            <div class=" pointerOnHover">
              Upload
            </div>
            <input style="visibility: collapse; width: 0; height: 0;"  type="file" class="file-input" (change)="onFileSelected(fileUpload)" #fileUpload>
          </div>
          <div style="margin: 1px" class="flex flex-row align-items-center unbordered-button h-2rem"
            (click)="downloadProject()">
            <i class="pi pi-fw pi-download" style="margin-right: 5px;"></i>
            <div class=" pointerOnHover">
              Download
            </div>
          </div>
          <div style="margin: 1px" class="flex flex-row align-items-center unbordered-button h-2rem">
            <i class="pi pi-fw pi-save" style="margin-right: 5px;"></i>
            <div class=" pointerOnHover">
              Save
            </div>
          </div>
          <div style="margin: 1px" class="flex flex-row align-items-center unbordered-button h-2rem">
            <i class="pi pi-fw pi-save" style="margin-right: 5px;"></i>
            <div class=" pointerOnHover">
              Load
            </div>
          </div>
        </ng-template>
      </p-panel>
      <p-panel [toggleable]="true" #settings class="sidemenuPanel panel-hide-default-toggler" [collapsed]="true">
        <ng-template pTemplate="header">
          <div class="flex justify-content-between align-items-center">
            <button (click)="settings.toggle($event); $event.stopPropagation()" pButton pRipple type="button"
              [icon]="'pi '+(settings.collapsed?'pi-chevron-right':'pi-chevron-down')"
              class="p-panel-header-icon"></button>
            <i class="pi pi-fw pi-cog" style="margin-right: 5px;"></i>
            <span>
              Settings
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="content">

        </ng-template>
      </p-panel>

    </div>
  </div>
  <div class="center flex min-h-full w-full relative overflow-hide">
    <div class="absolute left-0 bottom-0 flex flex-column z-2 footer">
      <div class="element pi pi-arrow-circle-up pointerOnHover" (click)="contentPanel.scrollTop(0)"></div>
      <div class="pseudo"></div>
      <div class="element pi pi-arrow-circle-down pointerOnHover" (click)="contentPanel.scrollTop(infinity)"></div>
      <div class="pseudo"></div>
      <div class="element pi pi-window-maximize pointerOnHover"></div>
      <div class="pseudo"></div>
      <div class="element pi pi-window-minimize pointerOnHover"></div>
    </div>
    <div class="absolute left-43px bottom-0 flex flex-row z-3 footer">
      <div class="pi pi-globe element pointerOnHover"></div>
      <div class="pseudo"></div>
      <div class="pi pi-plus-circle element pointerOnHover"></div>
    </div>
    <div class="absolute right-0 bottom-0 flex flex-row z-3 footer">
      <div class="pi pi-users element pointerOnHover"></div>
    </div>
    <p-scrollPanel class="content" [style]="{width: '100%', height: '100%'}" styleClass="custombar" #contentPanel
      id="contentPanel">
      <div style="padding-bottom: 20vh;" *ngIf="project">
        <div *ngFor="let panel of project.views[project.activeViewIndex].panels, let index = index"
          (mouseenter)="project.views[project.activeViewIndex].activePanelIndex = index">
          <div class="pseudo" #pseudo></div>
          <app-note-panel [isActivePanel]="project.views[project.activeViewIndex].activePanelIndex === index"
            *ngIf="panelIsInstanceOf(panel, notePanelType)" [notes]="project.notes" [categories]="project.categories"
            [noteName]="panel.uniqueName" [panel]="panel" (internalLinkActivatedEvent)="navigateInternalLink($event)"
            (closePanelEvent)="removePanelFromActiveView(panel)"
            (moveUpEvent)="moveUp(index, project.views[project.activeViewIndex].panels)"
            (moveDownEvent)="moveDown(index, project.views[project.activeViewIndex].panels)"></app-note-panel>
          <app-category-panel [isActivePanel]="project.views[project.activeViewIndex].activePanelIndex === index"
            *ngIf="panelIsInstanceOf(panel, categoryPanelType)" [categories]="project.categories"
            [categoryName]="panel.uniqueName" [panel]="panel"
            (internalLinkActivatedEvent)="navigateInternalLink($event)"
            (closePanelEvent)="removePanelFromActiveView(panel)"
            (moveUpEvent)="moveUp(index, project.views[project.activeViewIndex].panels)"
            (moveDownEvent)="moveDown(index, project.views[project.activeViewIndex].panels)"></app-category-panel>
        </div>
      </div>
      <div class="pseudo"></div>
    </p-scrollPanel>
  </div>
  <div class="right sidebar min-h-full w-2 p-shadow-3 overflow-hidden">
    <div class="p-1 flex flex-column h-full overflow-y-auto">
      <div class="flex flex-row">
        <span class="p-input-icon-right w-full" style="margin-bottom: 1px;">
          <i class="pi pi-search"></i>
          <input type="text" class="w-full" placeholder="Search/Link" [(ngModel)]="rightSearch" pInputText />
        </span>
        <div
          class="button-border border-clickable flex flex-column align-content-center justify-content-center color-surface-card"
          style="margin-bottom: 1px; margin-left: 1px;">
          <i class="pi pi-ellipsis-v icon-button"></i>
        </div>
      </div>

      <div *ngIf="rightSearch && project">
        <div class="bordered-element h-2rem flex flex-row justify-content-between pointerOnHover"
          (click)="getRelatedElements(project.views[project.activeViewIndex].panels[project.views[project.activeViewIndex].activePanelIndex])?.push(rightSearch); rightSearch = ''">
          <span style="padding: 8px">{{'New Link: ' + rightSearch}}</span>
        </div>
        <div style="padding-bottom: 1px;"></div>
      </div>
      <div
        *ngFor="let element of project ? getRelatedElements(project.views[project.activeViewIndex].panels[project.views[project.activeViewIndex].activePanelIndex]) : []">
        <div
          class="bordered-element h-2rem notes flex flex-row justify-content-between hideChildUntilHoverParent pointerOnHover"
          (click)="onNoteClick(element, contentPanel)" *ngIf="!rightSearch || element.includes(rightSearch)">
          <span style="padding: 8px">{{element}}</span>
          <div
            class="button-unbordered border-clickable flex flex-column flex-wrap align-content-center justify-content-center color-surface-card hideChildUntilHoverChild"
            style="width: 32px;">
            <i class="pi pi-ellipsis-v icon-button"></i>
          </div>
        </div>
        <div style="padding-bottom: 1px;"></div>
      </div>
    </div>
  </div>
  <p-toast position="bottom-center"></p-toast>
</div>
